## 영등포구 확장 프로젝트 - 1단계 상세설명

> 🎯 **목표**: 영등포구 다이소 수집 및 편의점 데이터 수집
> 
> 📁 **관련 파일**: 
> - `collect_yeongdeungpo_daiso.py` (영등포구 다이소 수집 - 그리드 기반)
> - `collect_convenience_only.py` (편의점만 수집 - 엄격한 필터링)
> - `deduplicate_stores.py` (중복 분석)
>
> 🐳 **실행 환경**: Docker (web + db 컨테이너)

---

### 1-1. Docker 환경 시작

```powershell
# 1. 프로젝트 폴더로 이동
cd C:\A3_radius_collector-Public

# 2. Docker Compose 실행 (백그라운드 모드)
docker compose up -d

# 3. 컨테이너 상태 확인
docker compose ps
```

**예상 결과:**
```
NAME                              IMAGE                    STATUS        PORTS
a3_radius_collector-public-db-1   postgis/postgis:16-3.4   Up           0.0.0.0:5433->5432/tcp
a3_radius_collector-public-web-1  a3_radius_...            Up           0.0.0.0:8000->8000/tcp
```

**컨테이너 구조:**
```
┌─────────────────────────────────────────────────────────────┐
│                    Docker Compose                           │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐    ┌─────────────────────┐         │
│  │        web          │    │         db          │         │
│  │  (Django + GDAL)    │───▶│  (PostGIS 16-3.4)   │         │
│  │   Port: 8000        │    │   Port: 5433        │         │
│  └─────────────────────┘    └─────────────────────┘         │
│           ↑                                                 │
│     localhost:8000                                          │
└─────────────────────────────────────────────────────────────┘
```

> ⚠️ **주의**: 카카오 API 키가 필요합니다. 
> 1. [카카오 개발자 사이트](https://developers.kakao.com/)에서 발급받으세요.
> 2. 프로젝트 루트의 `.env` 파일에 설정하면 자동으로 읽어옵니다:
>    ```
>    KAKAO_API_KEY=나의_API_키
>    ```

---

### 1-2. Docker에서 마이그레이션 실행

```powershell
# DB 마이그레이션 (최초 1회 또는 모델 변경 시)
docker compose exec web python manage.py migrate

# 마이그레이션 상태 확인
docker compose exec web python manage.py showmigrations
```

---

### 1-3. 영등포구 다이소 수집 (개선판)

```
수집 흐름 (그리드 기반):
┌─────────────────────────────────────────────────────────────┐
│                   영등포구 경계 영역                         │
│  ┌───┬───┬───┬───┐                                          │
│  │ 1 │ 2 │ 3 │ 4 │  ← 4x4 = 16개 그리드로 분할             │
│  ├───┼───┼───┼───┤    각 그리드마다 "다이소" 키워드 검색    │
│  │ 5 │ 6 │ 7 │ 8 │                                          │
│  ├───┼───┼───┼───┤                                          │
│  │ 9 │10 │11 │12 │                                          │
│  ├───┼───┼───┼───┤                                          │
│  │13 │14 │15 │16 │                                          │
│  └───┴───┴───┴───┘                                          │
└─────────────────────────────────────────────────────────────┘
           ↓
     [엄격한 주소 검증]
     - "영등포구" 포함 필수
     - 다른 구 (구로구, 양천구 등) 제외
           ↓
     ✅ 영등포구 다이소만 저장
```

**Docker에서 실행:**
```powershell
# 영등포구 다이소 수집 (그리드 기반 완전 수집)
docker compose exec web python manage.py collect_yeongdeungpo_daiso

# 기존 데이터 삭제 후 재수집
docker compose exec web python manage.py collect_yeongdeungpo_daiso --clear

# 그리드 크기 조정 (기본: 4x4)
docker compose exec web python manage.py collect_yeongdeungpo_daiso --grid-size=5
```

**예상 결과:**
```
--- 영등포구 다이소 수집 시작 (4x4=16개 그리드) ---
[1/16] 그리드[1,1] 검색 중...
  ✅ 발견: 다이소 신길점
  ✅ 발견: 다이소 대림점
[2/16] 그리드[1,2] 검색 중...
  ✅ 발견: 다이소 영등포역점
...

--- 동별 추가 검색 ---
  ✅ 추가 발견 (여의도동): 다이소 여의도점
  ✅ 추가 발견 (당산동): 다이소 당산점

--- 수집 완료 ---
  ✅ 이번 수집: 20개
  📊 DB 전체: 20개
  ⚠️ 스킵 (영등포구 아님): 0개
```

**수집 확인:**
```powershell
# Django Shell 접속
docker compose exec web python manage.py shell

>>> from stores.models import YeongdeungpoDaiso
>>> YeongdeungpoDaiso.objects.count()
# 예상: 15~25개

# 신길점 포함 확인
>>> YeongdeungpoDaiso.objects.filter(name__icontains='신길').count()
# 예상: 1개 이상

>>> exit()
```

---

### 1-4. 편의점 데이터 수집 (개선판)

```
수집 흐름:
┌──────────────────┐
│ YeongdeungpoDaiso │   영등포구 다이소 목록 (완전 수집)
│  (그리드 수집)    │
└───────┬──────────┘
        ↓
┌───────────────────────────────────────────┐
│  각 다이소 지점 기준 반경 1km 내 검색      │
│  카카오 카테고리: CS2 (편의점)             │
└───────┬───────────────────────────────────┘
        ↓
  [엄격한 영등포구 필터링]
  - 다른 구 주소 제외
        ↓
┌──────────────────────────┐
│ YeongdeungpoConvenience  │   영등포구 편의점만 저장
└──────────────────────────┘
```

**Docker에서 실행:**
```powershell
# 영등포구 다이소 기준 편의점만 수집
docker compose exec web python manage.py collect_convenience_only

# 기존 데이터 삭제 후 재수집
docker compose exec web python manage.py collect_convenience_only --clear

# 탐색 반경 조정 (기본: 1km)
docker compose exec web python manage.py collect_convenience_only --radius=1.5
```

**예상 결과:**
```
총 20개의 영등포구 다이소에 대해 편의점 수집을 시작합니다.
탐색 반경: 1.0km
[1/20] '다이소 신길점' 주변 편의점 탐색 중...
  -> 45개 저장, 12개 스킵 (영등포구 아님)
[2/20] '다이소 영등포역점' 주변 편의점 탐색 중...
  -> 38개 저장, 8개 스킵 (영등포구 아님)
...

--- 수집 완료 ---
  ✅ 이번 수집: 450개
  ⚠️ 스킵 (영등포구 아님): 120개

📊 현재 DB 상태:
  - 영등포구 편의점: 450개
  - 영등포구 외 데이터: 0개
```

---

### 1-5. 중복 데이터 분석

```
중복 발생 원인:
┌─────────────────────┐     ┌─────────────┐
│ 다이소 A (신길점)   │ ──→ │ GS25 신길역점 │
└─────────────────────┘     └─────────────┘
                                  ↑
┌─────────────────────┐           │ 동일 편의점!
│ 다이소 B (영등포역) │ ──────────┘
└─────────────────────┘

해결: place_id 기준으로 고유 편의점만 식별
```

**Docker에서 실행:**
```powershell
# 중복 데이터 분석
docker compose exec web python manage.py deduplicate_stores

# 상세 정보 출력
docker compose exec web python manage.py deduplicate_stores --verbose
```

---

### 1-6. 1단계 완료 확인

```powershell
# Django Shell에서 전체 확인
docker compose exec web python manage.py shell
```

```python
>>> from stores.models import YeongdeungpoDaiso, YeongdeungpoConvenience

# 1. 영등포구 다이소 수
>>> YeongdeungpoDaiso.objects.count()
# 예상: 15~25개 (신길점 포함)

# 2. 신길점 확인
>>> YeongdeungpoDaiso.objects.filter(name__icontains='신길')
# 예상: <QuerySet [<YeongdeungpoDaiso: 다이소 신길점>]>

# 3. 편의점 수
>>> YeongdeungpoConvenience.objects.count()
# 예상: 400~600개

# 4. 영등포구 외 데이터 확인 (0개여야 함)
>>> [c for c in YeongdeungpoConvenience.objects.all()[:100] if '영등포구' not in c.address]
# 예상: []

>>> exit()
```

---

### 1-7. Docker 관리 명령어

```powershell
# 로그 확인 (실시간)
docker compose logs -f web

# 컨테이너 중지 (데이터 유지)
docker compose down

# 컨테이너 중지 + 데이터 삭제 (초기화)
docker compose down -v

# 컨테이너 재시작
docker compose restart web

# web 컨테이너만 재빌드
docker compose up -d --build web
```

---

### 1단계 요약

| 작업 | Docker 명령어 | 결과 |
|------|--------------|------|
| 환경 시작 | `docker compose up -d` | web + db 컨테이너 |
| 마이그레이션 | `docker compose exec web python manage.py migrate` | DB 테이블 생성 |
| 영등포구 다이소 수집 | `docker compose exec web python manage.py collect_yeongdeungpo_daiso` | 15~25개 (그리드 기반) |
| 편의점 수집 | `docker compose exec web python manage.py collect_convenience_only` | 400~600개 (엄격 필터) |
| 중복 분석 | `docker compose exec web python manage.py deduplicate_stores` | 통계 확인 |

```
1단계 완료 후 데이터 구조:
┌──────────────────────────┐
│   YeongdeungpoDaiso      │  ← PostgreSQL (PostGIS)
│  영등포구 다이소          │     yeongdeungpo_daiso 테이블
│  (15~25개, 그리드 수집)   │     ✅ 신길점 포함!
└────────┬─────────────────┘
         │ 1:N 관계
         ↓
┌──────────────────────────┐
│ YeongdeungpoConvenience  │
│  영등포구 편의점          │     ✅ 엄격한 영등포구 필터
│  (400~600개)             │
└──────────────────────────┘
```

---

> 📌 **다음 단계**: [2단계 - 공공데이터 비교 및 폐업 매장 탐지](./영등포구확장(2단계)상세설명.md)
